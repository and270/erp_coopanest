{% extends 'layout.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Avaliação RPA{% endblock %}

{% block content %}
<style>
    .container-form {
        flex: 1;
        width: 100%;
        padding: 20px;
        box-sizing: border-box;
    }
    h1 {
        color: #1A73E8;
        font-size: 18px;
        font-weight: 600;
        line-height: 19.36px;
        text-align: left;
        margin-bottom: 20px;
    }
    p {
        font-size: 12px;
        font-weight: 500;
        line-height: 14.52px;
        text-align: left;
        margin-bottom: 20px;
    }
    form {
        display: flex;
        flex-direction: column;
        min-height: calc(100vh - 40px);
        background-color: #ffffff;
        padding: 20px;
    }
    label {
        display: block;
        font-size: 13px;
        font-weight: 500;
        line-height: 14.52px;
        text-align: left;
        margin-bottom: 10px;
    }
    .radio-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
    }
    .radio-option {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    input[type="radio"] {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        width: 20px;
        height: 20px;
        border: 1px solid #E6E6E6;
        border-radius: 50%;
        outline: none;
        cursor: pointer;
        margin-right: 10px;
    }
    input[type="radio"]:checked {
        border: 5px solid #1A73E8;
    }
    .input-width-280 {
        max-width: 580px;
    }
    .radio-option label {
        font-size: 8px;
        font-weight: 500;
        line-height: 12.1px;
        margin-bottom: 0;
    }
    textarea {
        width: calc(100% - 20px);
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #E6E6E6;
        border-radius: 5px;
        resize: vertical;
        font-family: 'Inter', sans-serif;
        font-size: 12px;
        box-sizing: border-box;
    }
    button[type="submit"] {
        background-color: #1A73E8;
        color: #ffffff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        font-family: 'Inter', sans-serif;
        font-size: 16px;
        width: 103px;
        height: 40px;
        float: right;
        margin-top: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    button[type="submit"]:hover {
        background-color: #1557b0;
    }
    .button-container {
        width: 100%;
        display: flex;
        justify-content: flex-end;
        padding-top: 20px;
        background-color: #ffffff;
    }

    input, select, textarea {
        font-family: 'Inter', sans-serif;
        font-size: 12px;
    }

    input[type="time"] {
        font-family: 'Inter', sans-serif;
    }

    select, 
    select option,
    input[type="text"],
    input[type="time"],
    textarea {
        font-size: 12px;
        line-height: 14.52px;
    }

    .form-options-text,
    .form-options-text option,
    input.form-options-text,
    select.form-options-text,
    textarea.form-options-text {
        font-size: 12px;
        line-height: 1.2;
    }

    .radio-option label,
    .radio-group label {
        font-size: 12px;
        line-height: 1.2;
    }

    .radio-option {
        font-size: 12px;
        line-height: 1.2;
    }

    .scale-name {
        font-weight: 500;
    }

    @media (max-width: 480px) {
        .button-container {
            position: sticky;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }
    }

    /* Novo estilo para os campos específicos */
    .scale-container {
        margin-bottom: 20px;
    }

    .horizontal-radio-group {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        position: relative;
        width: 100%;
        /* Remove o gap e padding */
    }

    .rainbow-scale {
        height: 8px;
        width: 100%;
        margin-bottom: 10px;
        background: linear-gradient(to right, 
            #00B4D8, /* azul claro */
            #90E0EF, /* azul mais claro */
            #CAF0F8, /* azul bem claro */
            #FFEE93, /* amarelo claro */
            #FFB347, /* laranja */
            #FF6B6B  /* vermelho */
        );
        border-radius: 4px;
    }

    .horizontal-radio-group .radio-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        /* Remove flex: 1 e define uma largura específica */
        width: 30px; /* ou o valor que melhor se adequar ao seu layout */
    }

    .horizontal-radio-group .radio-option:first-child {
        align-items: flex-start;
    }

    .horizontal-radio-group .radio-option:last-child {
        align-items: flex-end;
    }

    .scale-descriptions {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 10px;
        color: #666;
        align-items: flex-end;
    }

    .scale-description {
        max-width: 20%;
        text-align: center;
    }

    .scale-description.left {
        text-align: left;
    }

    .scale-description.right {
        text-align: right;
    }

    /* Ajuste para telas pequenas */
    @media (max-width: 480px) {
        .horizontal-radio-group {
            flex-direction: row;
        }
        .rainbow-scale {
            width: 100%;
        }
    }
</style>
<div class="container-form">
    <form method="post" id="avaliacaoRPAForm">
        <h1>Avaliação RPA</h1>
        {% csrf_token %}
        <div class="radio-group">
            <label for="{{ form.tempo_alta_rpa.id_for_label }}">{{ form.tempo_alta_rpa.label }}</label>
            <div class="input-width-280">{{ form.tempo_alta_rpa }}</div>
        </div>
        <div class="radio-group">
            <label>{{ form.dor_pos_operatoria.label }}</label>
                {% for radio in form.dor_pos_operatoria %}
                    <div class="radio-option">
                        <label>{{ radio.tag }}</label>
                        {{ radio.choice_label }}
                    </div>
                {% endfor %}
        </div>
        <div class="radio-group">
            <label>{{ form.escala.label }}</label>
            {% for radio in form.escala %}
                {% if radio.choice_label != '---------' %}
                    <div class="radio-option">
                        <label>{{ radio.tag }}</label>
                        {{ radio.choice_label }}
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <!-- EVA specific fields -->
        <div id="eva-fields" class="radio-group scale-container">
            <label>{{ form.eva_score.label }}</label>
            <div class="scale-descriptions">
                <span class="scale-description left">Dor leve</span>
                <span class="scale-description">Dor moderada</span>
                <span class="scale-description right">Dor intensa</span>
            </div>
            <div class="rainbow-scale"></div>
            <div class="horizontal-radio-group">
                {% for radio in form.eva_score %}
                    <div class="radio-option">
                        <label>{{ radio.tag }}</label>
                        {{ radio.choice_label }}
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- FLACC specific fields -->
        <div id="flacc-fields" class="radio-group">
            {% for field in form %}
                {% if field.name in 'face,pernas,atividade,choro,consolabilidade' %}
                    <div class="scale-container">
                        <label>{{ field.label }}</label>
                        <div class="scale-descriptions">
                            <span class="scale-description left">{{ form.FLACC_DESCRIPTIONS|get_item:field.name|get_item:'low' }}</span>
                            <span class="scale-description">{{ form.FLACC_DESCRIPTIONS|get_item:field.name|get_item:'mid' }}</span>
                            <span class="scale-description right">{{ form.FLACC_DESCRIPTIONS|get_item:field.name|get_item:'high' }}</span>
                        </div>
                        <div class="rainbow-scale"></div>
                        <div class="horizontal-radio-group">
                            {% for radio in field %}
                                <div class="radio-option">
                                    <label>{{ radio.tag }}</label>
                                    {{ radio.choice_label }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <!-- BPS specific fields -->
        <div id="bps-fields" class="radio-group">
            {% for field in form %}
                {% if field.name in 'expressao_facial,movimentos_membros_superiores,adaptacao_ventilador' %}
                    <div class="scale-container">
                        <label>{{ field.label }}</label>
                        <div class="scale-descriptions">
                            <span class="scale-description left">{{ form.BPS_DESCRIPTIONS|get_item:field.name|get_item:'low' }}</span>
                            <span class="scale-description">{{ form.BPS_DESCRIPTIONS|get_item:field.name|get_item:'mid' }}</span>
                            <span class="scale-description">{{ form.BPS_DESCRIPTIONS|get_item:field.name|get_item:'high' }}</span>
                            <span class="scale-description right">{{ form.BPS_DESCRIPTIONS|get_item:field.name|get_item:'extreme' }}</span>
                        </div>
                        <div class="rainbow-scale"></div>
                        <div class="horizontal-radio-group">
                            {% for radio in field %}
                                <div class="radio-option">
                                    <label>{{ radio.tag }}</label>
                                    {{ radio.choice_label }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <!-- PAINAD-B specific fields -->
        <div id="painad-b-fields" class="radio-group">
            {% for field in form %}
                {% with painad_fields='respiracao,vocalizacao_negativa,expressao_facial_painad,linguagem_corporal,consolabilidade_painad'|split:',' %}
                    {% if field.name in painad_fields %}
                        <div class="scale-container">
                            <label>{{ field.label }}</label>
                            <div class="scale-descriptions">
                                <span class="scale-description left">{{ form.PAINAD_B_DESCRIPTIONS|get_item:field.name|get_item:'low' }}</span>
                                <span class="scale-description">{{ form.PAINAD_B_DESCRIPTIONS|get_item:field.name|get_item:'mid' }}</span>
                                <span class="scale-description right">{{ form.PAINAD_B_DESCRIPTIONS|get_item:field.name|get_item:'high' }}</span>
                            </div>
                            <div class="rainbow-scale"></div>
                            <div class="horizontal-radio-group">
                                {% for radio in field %}
                                    <div class="radio-option">
                                        <label>{{ radio.tag }}</label>
                                        {{ radio.choice_label }}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
            {% endfor %}
        </div>

        <!-- Common fields -->
        <div class="radio-group">
            <label>{{ form.evento_adverso.label }}</label>
                {% for radio in form.evento_adverso %}
                    <div class="radio-option">
                        <label>{{ radio.tag }}</label>
                        {{ radio.choice_label }}
                    </div>
                {% endfor %}
        </div>
        <div class="radio-group" id="evento_adverso_qual_group" style="display: none;">
            <label for="{{ form.evento_adverso_qual.id_for_label }}">{{ form.evento_adverso_qual.label }}</label>
            {{ form.evento_adverso_qual }}
        </div>
        <div class="radio-group">
            <label>{{ form.ponv.label }}</label>
                {% for radio in form.ponv %}
                    <div class="radio-option">
                        <label>{{ radio.tag }}</label>
                        {{ radio.choice_label }}
                    </div>
                {% endfor %}
        </div>
        <div class="button-container">
            <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('avaliacaoRPAForm');
        const escalaInputs = form.querySelectorAll('input[name="escala"]');
        const evaFields = document.getElementById('eva-fields');
        const flaccFields = document.getElementById('flacc-fields');
        const bpsFields = document.getElementById('bps-fields');
        const painadBFields = document.getElementById('painad-b-fields');

        function showRelevantFields() {
            const selectedScale = form.querySelector('input[name="escala"]:checked');
            const selectedValue = selectedScale ? selectedScale.value : null;

            evaFields.style.display = selectedValue === 'EVA' ? 'block' : 'none';
            flaccFields.style.display = selectedValue === 'FLACC' ? 'block' : 'none';
            bpsFields.style.display = selectedValue === 'BPS' ? 'block' : 'none';
            painadBFields.style.display = selectedValue === 'PAINAD-B' ? 'block' : 'none';

            // If no scale is selected, hide all specific fields
            if (!selectedValue) {
                evaFields.style.display = 'none';
                flaccFields.style.display = 'none';
                bpsFields.style.display = 'none';
                painadBFields.style.display = 'none';
            }
        }

        escalaInputs.forEach(input => {
            input.addEventListener('change', showRelevantFields);
        });

        // Show relevant fields on page load
        showRelevantFields();

        // Add evento_adverso handling
        const eventoAdversoInputs = form.querySelectorAll('input[name="evento_adverso"]');
        const eventoAdversoQualGroup = document.getElementById('evento_adverso_qual_group');

        function toggleEventoAdversoQual() {
            const selectedEvento = form.querySelector('input[name="evento_adverso"]:checked');
            eventoAdversoQualGroup.style.display = selectedEvento && selectedEvento.value === 'True' ? 'block' : 'none';
        }

        eventoAdversoInputs.forEach(input => {
            input.addEventListener('change', toggleEventoAdversoQual);
        });

        // Show/hide on page load
        toggleEventoAdversoQual();
    });
</script>
{% endblock %}

