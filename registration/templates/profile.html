{% extends 'layout.html' %}
{% block title %}Perfil{% endblock %}

{% block content %}
<div class="profile-container">
    <h1>Seu Perfil</h1>
    <p><strong>Seu e-mail:</strong> {{ user.email }}</p>
    <p><strong>Seu acesso ao sistema:</strong> {{ user.get_user_type_display }}</p>
    {% if user.group %}
        <p><strong>Seu Grupo ativo:</strong> {{ user.group }}</p>
    {% endif %}

    {% if user.validado %}
        <p class="validation-status validated">Acesso validado</p>
    {% else %}
        <p class="validation-status not-validated">Acesso completo ainda não validado. Solicite ao administrador do sistema.</p>
    {% endif %}

    <hr>
    <h3>Múltiplos Grupos</h3>

    <!-- 1) SWITCH ACTIVE GROUP -->
    <p>Você participa de vários grupos? Selecione abaixo o grupo que deseja ativar agora:</p>
    
    <div class="form-group">
        <form method="POST" class="form-group-inline">
            {% csrf_token %}
            <input type="hidden" name="switch_active_group" value="1" />
            <div class="form-field">
                <label for="group_id">Selecione um grupo:</label>
                <select name="group_id" id="group_id">
                    {% for membership in user_memberships %}
                        <option value="{{ membership.group.id }}"
                            {% if membership.group == user.group %}selected{% endif %}>
                            {{ membership.group.name }}
                            {% if membership.validado %}(validado){% else %}(não validado){% endif %}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Ativar este grupo</button>
        </form>
    </div>

    <!-- 2) ADD ANOTHER GROUP MEMBERSHIP -->
    <h4>Entrar em outro grupo ou criar um novo</h4>
    
    <div class="form-group">
        <form method="POST" class="form-group-inline">
            {% csrf_token %}
            <input type="hidden" name="add_group" value="1" />
            
            <div class="form-field">
                <label>Selecione um grupo existente:</label>
                <input type="text" name="existing_group" placeholder="--------">
            </div>
            
            <button type="submit" class="btn btn-primary">Adicionar grupo</button>
        </form>
    </div>

    <p>Para alterar seu e-mail ou tipo de acesso, contate o administrador do sistema.</p>

    <!-- LOGOUT -->
    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="logout-button">Logout</button>
    </form>
</div>
{% endblock %}
